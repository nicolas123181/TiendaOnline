---
import PublicLayout from "../layouts/PublicLayout.astro";

export const prerender = false;
---

<PublicLayout
    title="Recuperar Contraseña - Vantage"
    description="Recupera tu contraseña de Vantage"
>
    <section class="min-h-[70vh] flex items-center justify-center py-12 px-4">
        <div class="w-full max-w-md">
            <!-- Card -->
            <div
                class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8"
            >
                <!-- Logo -->
                <div class="text-center mb-8">
                    <a href="/" class="inline-block">
                        <h1
                            class="text-2xl tracking-[0.3em] font-light text-[#1a2744]"
                        >
                            VANTAGE
                        </h1>
                    </a>
                    <div class="w-12 h-px bg-amber-600 mx-auto mt-3"></div>
                </div>

                <!-- Título -->
                <div class="text-center mb-8">
                    <h2 class="text-xl font-serif text-gray-900 mb-2">
                        Recuperar Contraseña
                    </h2>
                    <p class="text-gray-600 text-sm">
                        Introduce tu email y te enviaremos un enlace para
                        restablecer tu contraseña.
                    </p>
                </div>

                <!-- Formulario -->
                <form id="forgot-password-form" class="space-y-6">
                    <div>
                        <label
                            for="email"
                            class="block text-sm font-medium text-gray-700 mb-2"
                        >
                            Email
                        </label>
                        <input
                            type="email"
                            id="email"
                            name="email"
                            required
                            placeholder="tu@email.com"
                            class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#1a2744]/20 focus:border-[#1a2744] transition-all"
                        />
                    </div>

                    <!-- Mensajes -->
                    <div
                        id="error-message"
                        class="hidden p-4 bg-red-50 text-red-700 text-sm rounded-xl"
                    >
                    </div>

                    <div
                        id="success-message"
                        class="hidden p-4 bg-green-50 text-green-700 text-sm rounded-xl"
                    >
                    </div>

                    <button
                        type="submit"
                        id="submit-btn"
                        class="w-full py-3.5 bg-[#1a2744] text-white font-medium rounded-xl hover:bg-[#243555] transition-colors flex items-center justify-center gap-2"
                    >
                        Enviar enlace de recuperación
                    </button>
                </form>

                <!-- Links -->
                <div class="mt-8 pt-6 border-t border-gray-100 text-center">
                    <p class="text-sm text-gray-600">
                        ¿Recordaste tu contraseña?
                        <a
                            href="/login"
                            class="text-[#1a2744] font-medium hover:underline"
                        >
                            Iniciar sesión
                        </a>
                    </p>
                </div>
            </div>

            <!-- Footer -->
            <p class="text-center text-xs text-gray-400 mt-6">
                Si no recibes el email, revisa tu carpeta de spam.
            </p>
        </div>
    </section>
</PublicLayout>

<script>
    const form = document.getElementById(
        "forgot-password-form",
    ) as HTMLFormElement;
    const submitBtn = document.getElementById(
        "submit-btn",
    ) as HTMLButtonElement;
    const errorMessage = document.getElementById(
        "error-message",
    ) as HTMLDivElement;
    const successMessage = document.getElementById(
        "success-message",
    ) as HTMLDivElement;

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = (document.getElementById("email") as HTMLInputElement)
            .value;

        // Reset messages
        errorMessage.classList.add("hidden");
        successMessage.classList.add("hidden");

        // Disable button
        submitBtn.disabled = true;
        submitBtn.innerHTML = `
            <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
            </svg>
            Enviando...
        `;

        try {
            const response = await fetch("/api/auth/forgot-password", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email }),
            });

            const result = await response.json();

            if (result.success) {
                successMessage.textContent = result.message;
                successMessage.classList.remove("hidden");
                form.reset();
            } else {
                errorMessage.textContent =
                    result.error || "Error al procesar la solicitud";
                errorMessage.classList.remove("hidden");
            }
        } catch (error) {
            errorMessage.textContent = "Error de conexión. Inténtalo de nuevo.";
            errorMessage.classList.remove("hidden");
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = "Enviar enlace de recuperación";
        }
    });
</script>
